<!DOCTYPE html>
<html lang="en"  xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>购物车</title>
<meta name="generator" content="shopping 2.0" />
<meta name="author" content="www.shopping.com">
<meta name="copyright" content="shopping Inc. All Rights Reserved">
<link th:href="@{/style/system/front/default/css/public.css}" type="text/css" rel="stylesheet" />
<link th:href="@{/style/system/front/default/css/goods.css}" type="text/css" rel="stylesheet" />
<link th:href="@{/style/common/css/overlay.css}" type="text/css" rel="stylesheet" />

</head>
<body>
<div class="top_page">
  <div class="pageright" id="site-nav">
    <ul class="quick-menu">
      <li class="mytaobao menu-item menupx">
        <div class="menu"><a class="menu-hd" th:href="@{/buyer/index.htm}" rel="nofollow">我的订单<b></b></a>
          <div class="menu-bd">
            <div class="menu-bd-panel">
              <div>
                <a th:href="@{/buyer/order.htm(order_status=order_submit)}" rel="nofollow">待支付</a>
                <a th:href="@{/buyer/order.htm(order_status=order_shipping)}" rel="nofollow">待收货</a>
                <a th:href="@{/buyer/order.htm(order_status=order_receive)}" rel="nofollow">待评价</a>
              </div>
            </div>
          </div>
        </div>
      </li>
      <li class="mytaobao menu-item menupx">
        <div class="menu">
          <a class="menu-hd" th:href="@{/seller/index.htm}" rel="nofollow">商家支持<b></b></a>
          <div class="menu-bd">
            <div class="menu-bd-panel">
              <div>
                <a th:href="@{http://emode.xdjplus.com:8080/seller/index.htm}" rel="nofollow">商家中心</a>
                <a th:href="@{http://emode.xdjplus.com:8080/seller/order.htm}" rel="nofollow">商家订单</a>
                <a th:href="@{http://emode.xdjplus.com:8080/seller/goods.htm}" rel="nofollow">商家商品</a>
                <span th:switch="${user != null}">
									<a th:case="true" th:href="@{/store.htm(id=${user.storeId})}"
                                       rel="nofollow">我的店铺</a>
                                    <a th:case="false" th:href="@{/seller/store_create_first.htm}"
                                       rel="nofollow">商家入驻</a>
								</span>

              </div>
            </div>
          </div>
        </div>
      </li>

      <li class="search menu-item menupx">
        <div class="menu" id="cart_menu">
           <span class="menu-hd" id="cart_goods_top_menu">
                    <s></s>
                    <a th:href="@{/goods_cart1.htm}" rel="nofollow">购物车</a><b></b>
                  </span>
        </div>
      </li>
      <li class="menupx">
        <a th:href="@{/buyer/message.htm}">
          站内短信<span th:if="${msgs != null }" style="color:#FF3300;" th:text="${msgs.size()}"></span></a>
      </li>
      <li class="mytaobao menu-item menupx">
        <div class="menu">
          <a class="menu-hd" th:href="@{/buyer/favorite_goods.htm}" rel="nofollow">收藏夹<b></b></a>
          <div class="menu-bd">
            <div class="menu-bd-panel">
              <div>
                <a th:href="@{/buyer/favorite_goods.htm}" rel="nofollow">收藏商品</a>
                <a th:href="@{/buyer/favorite_store.htm}" rel="nofollow">收藏店铺</a>
              </div>
            </div>
          </div>
        </div>
      </li>

      <li th:if="${suer != null && user.userRole == 'ADMIN' }" class="menupx">
        <a th:href="@{/admin/index.htm}" target="_blank">管理后台</a>
      </li>
      <li class="menupx" th:if="${navs != null}">
        <a th:href="@{/articlelist.htm(param=help)}">帮助中心</a>
      </li>

      <li class="menupx" style="background:none;" th:if="${navs == null}">
        <a th:href="@{/articlelist.htm(param=help)}">帮助中心</a>
      </li>

      <li class="mytaobao menu-item menupx" style="background:none;" th:if="${navs != null }">
        <div class="menu">
          <a class="menu-hd" href="/buyer/index.htm" rel="nofollow">更多链接<b></b></a>
          <div class="menu-bd" style="height:auto;">
            <div class="menu-bd-panel">
              <div th:each="nav : ${navs}">
                <a th:href="@{ '/' + ${ nav.url }}" rel="nofollow" th:text="${nav.title}"></a>
              </div>
            </div>
          </div>
        </div>
      </li>

    </ul>
  </div>
  <div class="pageleft">
        <span th:switch="${user != null}">
          <span th:case="true">
             <span th:text="${user.username}"></span>
			  <span>您好,欢迎来到</span>
			  <span th:text=" ${config.websitename}"></span>
             <a th:href="@{/shopping_logout.htm}" class="lightblue">[退出]</a>
          </span>
          <span th:case="false">
			  <span>亲，欢迎来到</span><span th:text="${config.websitename}"></span>
             <span class="pxlr">
               <a th:href="@{/user/login.htm}" class="lightblue">登录</a>
             </span>
            <span class="pxlr">或</span>
            <span class="pxlr">
              <a th:href="@{/register.htm}" class="lightblue">注册</a>
            </span>
          </span>
        </span>
  </div>
</div>

<div class="main">
  <div id="header_form">
    <div id="head_h" class="head_width">
      <div class="head clearFix">
        <div class="logo">
          <a th:href="@{/index.htm}" th:if="${config.websiteLogo != null}">
            <img th:src="@{'/'+${config.websiteLogo.path}+'/'+${config.websiteLogo.name}}" border="0" width="180" height="60"/>
          </a>
          <a th:href="@{/index.htm}" th:if="${config.websiteLogo == null}">
            <img th:src="@{/style/system/front/default/images/logo.png}" border="0" width="180" height="60"/>
          </a>
        </div>
        <div class="searchForm">
          <form action="/search.htm" method="post" target="_blank" id="searchForm">
            <input name="type" type="hidden" id="type" value="${type}"/>
            <div class="toph_bigsearch">
              <div class="toph_sear">
                <ul class="toph_bgsear">
                  <li class="this" type="goods"><a href="javascript:void(0);">宝贝<s></s></a></li>
                  <li style="display:none" type="store"><a href="javascript:void(0);">店铺</a></li>
                </ul>
                <input name="keyword" type="text" id="keyword" placeholder="搜索其实真的很简单！" x-webkit-speech
                       lang="zh-CN" onwebkitspeechchange="jQuery('#searchForm').submit()"
                       class="toph_sear_txt"/>
                <input name="input" type="button" value="搜索" style="cursor:pointer;"
                       onclick="search_form();" class="toph_sear_btn"/>
              </div>
              <div class="keyword">
						   <span th:each="info : ${config.hotsearch.split(',')}">
							   <a href="javascript:void(0);" th:data="${info}" onclick="search_form(this.getAttribute('data'),'goods');"
                                  th:text="${info}"></a>
						   </span>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="index">
    <div class="index2">
      <div class="Steps">
            <ul>
                <li>1.查看购物车</li>
                <li>2.确认订单信息</li>
                <li class="this">3.付款到卖家</li>
                <li>4.确认收货</li>
                <li class="last">5.评价</li>
            </ul>
        </div>
      <form th:action="@{/order_pay.htm}" method="post" target="_blank" id="theForm">
      <div class="payorder">
        <div class="pay_top">
          <div class="payhh"></div>
          <div class="paybot">
            <h1>订单提交成功</h1>
            <h2>您的订单已成功生成，选择您想用的支付支付方式进行支付</h2>
            <ul>
              <li><strong>订单编号：</strong><strong class="orange" th:text="${orderNo}"></strong></li>
              <li><strong>应付金额：</strong><strong class="orange" th:text="'¥'+${totalPrice}"></strong></li>
            </ul>
            <h3>您可以在用户中心中<a th:href="@{/buyer/order.htm}">“我的订单”</a>查看该订单</h3>
          </div>
        </div>
        <div class="bank">
          <div class="banktitle">
            <h1><span>您可以选择付款方式</span></h1>
          </div>
          <div id="selectpay" class="bankcar">
              <ul >
                  <li>
                    <h1>在线支付</h1>
                    <div th:each="pay : ${pays}" class="bankone">
                      <span class="banksp">
                        <input name="payType" type="radio" th:value="${pay.mark}" checked="checked" />
                      </span>
                      <span class="bankimg">
                        <img th:if="${pay.mark == 'alipay' || pay.mark == 'alipay_wap'}"  th:src="@{/style/common/images/payment/alipay.jpg}" width="125" height="47" />
                        <img th:if="${pay.mark == 'paypal'}"  th:src="@{/style/common/images/payment/paypal.jpg}" width="125" height="47" />
                        <img th:if="${pay.mark == 'tenpay'}"   th:src="@{/style/common/images/payment/tenpay.jpg}" width="125" height="47" />
                        <img th:if="${pay.mark == 'outline'}"  th:src="@{/style/common/images/payment/outline.jpg}" width="125" height="47" />
                        <img th:if="${pay.mark == 'payafter'}" th:src="@{/style/common/images/payment/payafter.jpg}" width="125" height="47" />
                        <img th:if="${pay.mark == 'balance'}"  th:src="@{/style/common/images/payment/balance.jpg}" width="125" height="47" />
                        <img th:if="${pay.mark == 'wxcodepay' || pay.mark == 'weixin_wap'}" th:src="@{/style/common/images/payment/weixin.png}" width="125" height="47" />
                      </span>
                      <span class="bank_txt" th:text="${pay.content}"></span>
                    </div>

                </li>
              </ul>
            </div>
          <div class="banknextbtn">
            <input name="" type="button"  value="确认支付" onclick="order_pay();" style="cursor:pointer;"/>
            <input name="order_id" type="hidden" id="order_id" th:value="${orderNo}" />
          </div>
        </div>
      </div>
      </form>
    </div>
  </div>

   <!-- $!httpInclude.include("/footer.htm")-->
</div>
<div style="display:none;" id="pay_overlay">
  <div class="white_content">
  	<a href="javascript:void(0);" onclick="javascript:jQuery('#pay_overlay').hide();" class="white_close">
      <img th:src="@{/style/system/front/default/images/close.jpg}" width="14" height="14" /></a>
    <div class="white_box">
      <h1>支付提醒</h1>
      <dl class="white_dl">
        <dt></dt>
        <dd>
          <div class="payf">
            <a th:href="@{/order_finish.htm(order_id=${orderNo})}">已经完成支付！</a>
          </div>
          <div class="payf">
            <a href="javascript:void(0);"  onclick="javascript:jQuery('#pay_overlay').hide();" >支付出现问题！</a>
          </div>
        </dd>
      </dl>
    </div>
  </div>
  <div class="black_overlay"></div>
</div>

<div style="display:none;" id="wxcodepay_overlay">
  <div class="wx_content">
  	<a href="javascript:void(0);" onclick="javascript:jQuery('#wxcodepay_overlay').hide();" class="white_close">
      <img th:src="@{/style/system/front/default/images/close.jpg}" width="14" height="14" />
    </a>
    <div class="wx_box">
      <h1>微信二维码扫码支付</h1>
      <dl class="wx_dl">
        <dt id="wxPayCode" style="width: 200px;height: 200px">

        </dt>
        <dd>
          <div class="payf">
            <a th:href="@{/order_finish.htm(order_id=${orderNo})}">完成支付！</a>
          </div>
          <div class="payf">
            <a href="javascript:void(0);"  onclick="javascript:jQuery('#wxcodepay_overlay').hide();" >支付出现问题！</a>
          </div>
        </dd>
      </dl>
    </div>
  </div>
  <div class="black_overlay"></div>
</div>

</body>
<script type="text/javascript" th:src="@{http://static.runoob.com/assets/jquery/2.0.3/jquery.min.js}"></script>
<script type="text/javascript" th:src="@{http://static.runoob.com/assets/qrcode/qrcode.min.js}"></script>
<script th:src="@{/js/nav.js}"></script>
<script th:src="@{/js/top.js}"></script>
<script th:src="@{/js/head.js}"></script>
<script>

  var qrcode = new QRCode(document.getElementById("wxPayCode"), {
    width : 200,
    height : 200
  });


  function makeCode (elText) {
    if (!elText) {
      alert("Input a text");
      elText.focus();
      return;
    }
    qrcode.makeCode(elText);
  }

  //返回当前页面高度
  function order_pay(){
    var h=document.body.clientHeight;
    var top= document.documentElement.scrollTop;
    top=top+(h-top)/2;
    jQuery('.black_overlay').css("height",h);
    jQuery(".white_content").css("top",top);
    var payType = jQuery('#selectpay input[name="payType"]:checked ').val();
    var orderId = jQuery("#order_id").val();
    if(payType=="wxcodepay"){
      jQuery.get("",{"order_id":orderId},function(data){
        var data= JSON.parse(data);
        if(data.code == '200'){
          makeCode(datas.data);
          jQuery("#wxcodepay_overlay").show();
        }else{
          alert(datas.msg);
        }
      },"text");
    } else {
      jQuery('#pay_overlay').show();
      jQuery('#theForm').submit();
    }

  }
  window.onscroll=function(){
    var h=document.body.clientHeight;
    var top= document.documentElement.scrollTop;
    top=top-50+(h-top)/2;
    jQuery(".white_content").css("top",top);
  }
</script>

</html>
